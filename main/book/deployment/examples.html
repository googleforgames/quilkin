<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Architecture Examples - Quilkin Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../installation.html">Installation</a></li><li class="chapter-item expanded affix "><a href="../faq.html">FAQ</a></li><li class="chapter-item expanded affix "><li class="part-title">Quickstart Guides</li><li class="chapter-item expanded "><a href="../deployment/quickstarts/netcat.html"><strong aria-hidden="true">1.</strong> Netcat</a></li><li class="chapter-item expanded "><a href="../deployment/quickstarts/agones-xonotic-sidecar.html"><strong aria-hidden="true">2.</strong> Agones + Xonotic (Sidecar)</a></li><li class="chapter-item expanded "><a href="../deployment/quickstarts/agones-xonotic-xds.html"><strong aria-hidden="true">3.</strong> Agones + Xonotic (xDS)</a></li><li class="chapter-item expanded "><a href="../deployment/quickstarts/agones-xonotic-relay.html"><strong aria-hidden="true">4.</strong> Agones + Xonotic (Relay)</a></li><li class="chapter-item expanded affix "><li class="part-title">Services</li><li class="chapter-item expanded "><a href="../services/proxy.html"><strong aria-hidden="true">5.</strong> Proxy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/proxy/configuration.html"><strong aria-hidden="true">5.1.</strong> Configuration File</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters.html"><strong aria-hidden="true">5.2.</strong> Filters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/proxy/filters/capture.html"><strong aria-hidden="true">5.2.1.</strong> Capture</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/compress.html"><strong aria-hidden="true">5.2.2.</strong> Compress</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/concatenate.html"><strong aria-hidden="true">5.2.3.</strong> Concatenate</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/debug.html"><strong aria-hidden="true">5.2.4.</strong> Debug</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/drop.html"><strong aria-hidden="true">5.2.5.</strong> Drop</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/firewall.html"><strong aria-hidden="true">5.2.6.</strong> Firewall</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/load_balancer.html"><strong aria-hidden="true">5.2.7.</strong> Load Balancer</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/local_rate_limit.html"><strong aria-hidden="true">5.2.8.</strong> Local Rate Limit</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/match.html"><strong aria-hidden="true">5.2.9.</strong> Match</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/pass.html"><strong aria-hidden="true">5.2.10.</strong> Pass</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/timestamp.html"><strong aria-hidden="true">5.2.11.</strong> Timestamp</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/token_router.html"><strong aria-hidden="true">5.2.12.</strong> Token Router</a></li><li class="chapter-item expanded "><a href="../services/proxy/filters/writing_custom_filters.html"><strong aria-hidden="true">5.2.13.</strong> Writing Custom Filters</a></li></ol></li><li class="chapter-item expanded "><a href="../services/proxy/qcmp.html"><strong aria-hidden="true">5.3.</strong> Control Message Protocol</a></li><li class="chapter-item expanded "><a href="../services/proxy/metrics.html"><strong aria-hidden="true">5.4.</strong> Metrics</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><a href="../services/xds.html"><strong aria-hidden="true">6.</strong> Control Plane</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/xds/metrics.html"><strong aria-hidden="true">6.1.</strong> Metrics</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Providers</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/xds/providers/agones.html"><strong aria-hidden="true">6.2.1.</strong> Agones</a></li><li class="chapter-item expanded "><a href="../services/xds/providers/filesystem.html"><strong aria-hidden="true">6.2.2.</strong> Filesystem</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><a href="../services/relay.html"><strong aria-hidden="true">7.</strong> Relay</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> Metrics</div></li><li class="chapter-item expanded "><a href="../services/agent.html"><strong aria-hidden="true">7.2.</strong> Agents</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">SDKs</li><li class="chapter-item expanded "><a href="../sdks/unreal-engine.html"><strong aria-hidden="true">8.</strong> Unreal Engine</a></li><li class="chapter-item expanded affix "><li class="part-title">Deployment</li><li class="chapter-item expanded "><a href="../deployment/admin.html"><strong aria-hidden="true">9.</strong> Administration</a></li><li class="chapter-item expanded "><a href="../deployment/examples.html" class="active"><strong aria-hidden="true">10.</strong> Architecture Examples</a></li><li class="chapter-item expanded affix "><li class="part-title">Third Party</li><li class="chapter-item expanded "><a href="../third-party/presentations.html"><strong aria-hidden="true">11.</strong> Videos and Presentations</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Quilkin Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="quilkin-integration-examples"><a class="header" href="#quilkin-integration-examples">Quilkin Integration Examples</a></h1>
<p>The Quilkin proxy can be integrated with your dedicated game servers in several ways,
each providing different capabilities and complexity tradeoffs.</p>
<p>Below captures several of the most useful and prevalent architectural patterns to give you inspiration
on how you can use Quilkin in your multiplayer game networking architecture.</p>
<p>These <a href="https://github.com/googleforgames/quilkin/tree/main/examples">examples</a>
as well many others are available on Github repository.</p>
<h2 id="server-proxy-as-a-sidecar"><a class="header" href="#server-proxy-as-a-sidecar"><a href="https://github.com/googleforgames/quilkin/tree/main/examples/agones-xonotic-sidecar">Server Proxy as a Sidecar</a></a></h2>
<pre><code class="language-text">                  |
                  |
               Internet
                  |
                  |
                  |
┌─────────┐       |          ┌────────────────┐ ┌────────────────┐
│  Game   │       |          │ Quilkin        │ │ Dedicated      │
│  Client ◄──────────────────► (Server Proxy) │ │ Game Server    │
└─────────┘       |          │                ◄─►                │
                  |          └────────────────┘ └────────────────┘
                  |
                  |
                  |          ┌────────────────┐ ┌────────────────┐
                  |          │ Quilkin        │ │ Dedicated      │
                  |          │ (Server Proxy) │ │ Game Server    │
                  |          │                ◄─►                │
                  |          └────────────────┘ └────────────────┘
                  |
                  |
                  |
                  |
</code></pre>
<p>This is the simplest integration and configuration option with Quilkin, but does provide the smallest number
of possible feature implementations and ability to provide redundancy.</p>
<p>That being said, this is a low risk way to integrate Quilkin, and take advantage of the out-of-the-box telemetry
and metric information that comes with Quilkin.</p>
<ul>
<li>In this example, the Server proxy is running alongside the dedicated game server - on the same public IP/machine/container.
<ul>
<li>This is often referred to as a sidecar pattern.</li>
</ul>
</li>
<li>Communication between the Server Proxy and the Dedicated Game Server occurs over the localhost network, with a
separate port for each Game Client connection.</li>
<li>Clients connect to the Server Proxy's public port/IP combination, and the Server Proxy routes all traffic directly
to the dedicated game server.</li>
<li>The Server Proxy can still use filters such as rate limiting, compression, firewall rules, etc
as long as the Game Client conforms to the standard protocols utilised by those filters as appropriate.</li>
</ul>
<h2 id="client-proxy-to-sidecar-server-proxy"><a class="header" href="#client-proxy-to-sidecar-server-proxy">Client Proxy to Sidecar Server Proxy</a></h2>
<pre><code class="language-text">                                    |
                                    |
                                 Internet
                                    |
                                    |
                                    |
┌─────────┐    ┌────────────────┐   |        ┌────────────────┐ ┌────────────────┐
│  Game   │    │ Quilkin        │   |        │ Quilkin        │ │ Dedicated      │
│  Client ◄────► (Client Proxy) ◄────────────► (Server Proxy) │ │ Game Server    │
└─────────┘    └────────────────┘   |        │                ◄─►                │
                                    |        └────────────────┘ └────────────────┘
                                    |
                                    |
                                    |        ┌────────────────┐ ┌────────────────┐
                                    |        │ Quilkin        │ │ Dedicated      │
                                    |        │ (Server Proxy) │ │ Game Server    │
                                    |        │                ◄─►                │
                                    |        └────────────────┘ └────────────────┘
                                    |
                                    |
                                    |
                                    |
</code></pre>
<p>This example is the same as the above, but puts a Client Proxy between the Game Client, and the Server Proxy to take
advantage of Client Proxy functionality.</p>
<ul>
<li>The Client Proxy may be integrated as a standalone binary, directly into the client with communication
occurring over a localhost port or it may be possible utlise one of our client SDKs such as <a href="../sdks/unreal-engine.html">Unreal Engine</a>.</li>
<li>The Client Proxy can now utilise filters, such as compression, without having to change the Game Client.</li>
<li>The Game Client will need to communicate to the Client Proxy what IP it should connect to when the Client is
match-made with a Game Server.</li>
</ul>
<h2 id="client-proxy-to-separate-server-proxies-pools"><a class="header" href="#client-proxy-to-separate-server-proxies-pools"><a href="https://github.com/googleforgames/quilkin/tree/main/examples/agones-xonotic-xds">Client Proxy to Separate Server Proxies Pools</a></a></h2>
<pre><code class="language-text">                                       |                             |
                                       |                             |
                                    Internet                      Private
                                       |                          Network
                                       |     ┌────────────────┐      |       ┌────────────────┐
                                       |     │ Quilkin        │      |       │ Dedicated      │
                                       |  ┌──► (Server Proxy) ◄──────────┬───► Game Server    │
┌─────────┐      ┌────────────────┐    |  │  │                │      |   │   │                │
│  Game   │      │ Quilkin        ◄───────┤  └────────────────┘      |   │   └────────────────┘
│  Client ◄──────► (Client Proxy) │    |  │                          |   │
└─────────┘      └────────────────┘    |  │  ┌────────────────┐      |   │   ┌────────────────┐
                                       |  │  │ Quilkin        │      |   │   │ Dedicated      │
                                       |  └──► (Server Proxy) ◄──────────┘   │ Game Server    │
                                       |     │                │      |       │                │
                                       |     └────────────────┘      |       └────────────────┘
                                       |                             |
                                       |     ┌────────────────┐      |       ┌────────────────┐
                                       |     │ Quilkin        │      |       │ Dedicated      │
                                       |     │ (Server Proxy) │      |       │ Game Server    │
                                       |     │                │      |       │                │
                                       |     └────────────────┘      |       └────────────────┘
                                       |                 ▲           |              ▲
                                                         │                          │
                                                         │              ┌───────────┴────┐
                                                         │              │ xDS            │
                                                         └──────────────┤ Control Plane  │
                                                                        └────────────────┘




</code></pre>
<p>This is the most complex configuration, but enables the most reuse of Quilkin's functionality,
while also providing the most redundancy and security for your dedicated game servers.</p>
<ul>
<li>The Game client sends and receives packets from the Quilkin client proxy.</li>
<li>The Client Proxy may be integrated as a standalone binary, with communication occurring over a localhost port, or
it could be integrated directly with the game client as a library, or the client could utilise one of our
[client SDKs] if Rust integration is not possible.</li>
<li>The Client Proxy can utilise the full set of filters, such as concatenation (for routing), compression or load
balancing, without having to change the Game Client.</li>
<li>A hosted set of Quilkin Server proxies that have public IP addresses, are connected to an
<a href="../services/xds.html">xDS Control Plane</a> to coordinate routing and access control to the dedicated game servers, which are
on private IP addresses.</li>
<li>The Client Proxy is made aware of one or more Server proxies to connect to, possibly via their Game Client matchmaker
or another service, with an authentication token to pass to the Server proxies, such that the UDP packets can be
routed correctly to the dedicated game server they should connect to.</li>
<li>Dedicated game servers receive traffic as per normal from the Server Proxies, and send data back to the proxies
directly.</li>
<li>If the dedicated game server always expects traffic from only a single ip/port combination for client connection,
then traffic will always need to be sent through a single Server Proxy. Otherwise, UDP packets can be load
balanced via the Client Proxy to multiple Server Proxies for even greater redundancy.</li>
</ul>
<h2 id="what-next"><a class="header" href="#what-next">What Next?</a></h2>
<ul>
<li>Have a look at the <a href="./admin.html">Administration API</a>.</li>
<li>Review the <a href="../services/proxy/filters.html">set of filters</a> that are available.</li>
</ul>
<hr />
<p>Diagrams powered by <a href="http://asciiflow.com/" target="_blank">asciiflow.com</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../deployment/admin.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../third-party/presentations.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../deployment/admin.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../third-party/presentations.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
