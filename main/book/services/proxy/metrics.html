<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Metrics - Quilkin Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../../installation.html">Installation</a></li><li class="chapter-item expanded affix "><a href="../../faq.html">FAQ</a></li><li class="chapter-item expanded affix "><li class="part-title">Quickstart Guides</li><li class="chapter-item expanded "><a href="../../deployment/quickstarts/netcat.html"><strong aria-hidden="true">1.</strong> Netcat</a></li><li class="chapter-item expanded "><a href="../../deployment/quickstarts/agones-xonotic-sidecar.html"><strong aria-hidden="true">2.</strong> Agones + Xonotic (Sidecar)</a></li><li class="chapter-item expanded "><a href="../../deployment/quickstarts/agones-xonotic-xds.html"><strong aria-hidden="true">3.</strong> Agones + Xonotic (xDS)</a></li><li class="chapter-item expanded "><a href="../../deployment/quickstarts/agones-xonotic-relay.html"><strong aria-hidden="true">4.</strong> Agones + Xonotic (Relay)</a></li><li class="chapter-item expanded affix "><li class="part-title">Services</li><li class="chapter-item expanded "><a href="../../services/proxy.html"><strong aria-hidden="true">5.</strong> Proxy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../services/proxy/configuration.html"><strong aria-hidden="true">5.1.</strong> Configuration File</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters.html"><strong aria-hidden="true">5.2.</strong> Filters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../services/proxy/filters/capture.html"><strong aria-hidden="true">5.2.1.</strong> Capture</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/compress.html"><strong aria-hidden="true">5.2.2.</strong> Compress</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/concatenate.html"><strong aria-hidden="true">5.2.3.</strong> Concatenate</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/debug.html"><strong aria-hidden="true">5.2.4.</strong> Debug</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/drop.html"><strong aria-hidden="true">5.2.5.</strong> Drop</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/firewall.html"><strong aria-hidden="true">5.2.6.</strong> Firewall</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/load_balancer.html"><strong aria-hidden="true">5.2.7.</strong> Load Balancer</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/local_rate_limit.html"><strong aria-hidden="true">5.2.8.</strong> Local Rate Limit</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/match.html"><strong aria-hidden="true">5.2.9.</strong> Match</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/pass.html"><strong aria-hidden="true">5.2.10.</strong> Pass</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/timestamp.html"><strong aria-hidden="true">5.2.11.</strong> Timestamp</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/token_router.html"><strong aria-hidden="true">5.2.12.</strong> Token Router</a></li><li class="chapter-item expanded "><a href="../../services/proxy/filters/writing_custom_filters.html"><strong aria-hidden="true">5.2.13.</strong> Writing Custom Filters</a></li></ol></li><li class="chapter-item expanded "><a href="../../services/proxy/qcmp.html"><strong aria-hidden="true">5.3.</strong> Control Message Protocol</a></li><li class="chapter-item expanded "><a href="../../services/proxy/metrics.html" class="active"><strong aria-hidden="true">5.4.</strong> Metrics</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><a href="../../services/xds.html"><strong aria-hidden="true">6.</strong> Control Plane</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../services/xds/metrics.html"><strong aria-hidden="true">6.1.</strong> Metrics</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Providers</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../services/xds/providers/agones.html"><strong aria-hidden="true">6.2.1.</strong> Agones</a></li><li class="chapter-item expanded "><a href="../../services/xds/providers/filesystem.html"><strong aria-hidden="true">6.2.2.</strong> Filesystem</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><a href="../../services/relay.html"><strong aria-hidden="true">7.</strong> Relay</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> Metrics</div></li><li class="chapter-item expanded "><a href="../../services/agent.html"><strong aria-hidden="true">7.2.</strong> Agents</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">SDKs</li><li class="chapter-item expanded "><a href="../../sdks/unreal-engine.html"><strong aria-hidden="true">8.</strong> Unreal Engine</a></li><li class="chapter-item expanded affix "><li class="part-title">Deployment</li><li class="chapter-item expanded "><a href="../../deployment/admin.html"><strong aria-hidden="true">9.</strong> Administration</a></li><li class="chapter-item expanded "><a href="../../deployment/examples.html"><strong aria-hidden="true">10.</strong> Architecture Examples</a></li><li class="chapter-item expanded affix "><li class="part-title">Third Party</li><li class="chapter-item expanded "><a href="../../third-party/presentations.html"><strong aria-hidden="true">11.</strong> Videos and Presentations</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Quilkin Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="proxy-metrics"><a class="header" href="#proxy-metrics">Proxy Metrics</a></h1>
<p>The following are metrics that Quilkin provides while in Proxy Mode.</p>
<h1 id="asn-maxmind-information"><a class="header" href="#asn-maxmind-information">ASN Maxmind Information</a></h1>
<p>If Quilkin is provided a a MaxmindDB GeoIP database, Quilkin will log the
following information in the <code>maxmind information</code> log, as well as populate
the following fields in any metrics with matching labels.</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asn</code></td><td>ASN Number</td></tr>
<tr><td><code>organization</code></td><td>The organisation responsible for the ASN</td></tr>
<tr><td><code>country_code</code></td><td>The corresponding country code</td></tr>
<tr><td><code>ip_prefix</code></td><td>The IP prefix CIDR address</td></tr>
<tr><td><code>prefix_entity</code></td><td>The name of the entity for the prefix address</td></tr>
<tr><td><code>prefix_name</code></td><td>The name of the prefix address</td></tr>
</tbody></table>
</div>
<blockquote>
<p>Maxmind databases often require a licence and/or fee, so they aren't included
by default with Quilkin.</p>
</blockquote>
<h2 id="general-metrics"><a class="header" href="#general-metrics">General Metrics</a></h2>
<p>The proxy exposes the following general metrics:</p>
<ul>
<li>
<p><code>quilkin_packets_processing_duration_seconds{event, asn, ip_prefix}</code> (Histogram)</p>
<p>The total duration of time in seconds that it took to process a packet.</p>
<ul>
<li>The <code>event</code> label is either:
<ul>
<li><code>read</code>: when the proxy receives data from a downstream connection on the listening port.</li>
<li><code>write</code>: when the proxy sends data to a downstream connection via the listening port.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>quilkin_packets_dropped_total{reason, asn, ip_prefix}</code> (Counter)</p>
<p>The total number of packets (not associated with any session) that were dropped by proxy.
Not that packets reflected by this metric were dropped at an earlier stage before they were associated with any session. For session based metrics, see the list of <a href="#session-metrics">session metrics</a> instead.</p>
<ul>
<li><code>reason = NoConfiguredEndpoints</code>
<ul>
<li><code>NoConfiguredEndpoints</code>: No upstream endpoints were available to send the packet to. This can occur e.g if the endpoints cluster was scaled down to zero and the proxy is configured via a control plane.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>quilkin_cluster_active</code></p>
<p>The number of currently active clusters.</p>
</li>
<li>
<p><code>quilkin_cluster_active_endpoints</code></p>
<p>The number of currently active upstream endpoints. Note that this tracks the number of endpoints that the proxy
knows of rather than those that it is connected to (see <a href="#session-metrics">Session Metrics</a> instead for those)</p>
</li>
<li>
<p><code>quilkin_bytes_total{event, asn, ip_prefix}</code></p>
<p>The total number of bytes sent or recieved</p>
<ul>
<li>The <code>event</code> label is either:
<ul>
<li><code>read</code>: when the proxy receives data from a downstream connection on the listening port.</li>
<li><code>write</code>: when the proxy sends data to a downstream connection via the listening port.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>quilkin_packets_total{event, asn, ip_prefix}</code></p>
<p>The total number of packets sent or recieved.</p>
<ul>
<li>The <code>event</code> label is either:
<ul>
<li><code>read</code>: when the proxy receives data from a downstream connection on the listening port.</li>
<li><code>write</code>: when the proxy sends data to a downstream connection via the listening port.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>quilkin_packet_jitter{event, asn, ip_prefix}</code></p>
<p>The time between receiving new packets.</p>
</li>
<li>
<p><code>quilkin_errors_total{event, asn, ip_prefix}</code></p>
<p>The total number of errors encountered while reading a packet from the upstream endpoint.</p>
</li>
</ul>
<h2 id="session-metrics"><a class="header" href="#session-metrics">Session Metrics</a></h2>
<p>The proxy exposes the following metrics around sessions:</p>
<ul>
<li>
<p><code>quilkin_session_active{asn, organization, country_code, ip_prefix, prefix_entity, prefix_name}</code></p>
<p>The number of currently active sessions. If a maxmind database has been
provided, the labels are populated:</p>
<ul>
<li>The <code>asn</code> label is the <a href="https://en.wikipedia.org/wiki/Autonomous_system_(Internet)">ASN</a> number of the connecting
client.</li>
<li>The <code>ip_prefix</code>label is the IP prefix of the connecting client.</li>
</ul>
</li>
<li>
<p><code>quilkin_session_duration_secs</code> (Histogram)</p>
<p>A histogram over how long sessions lasted before they were torn down. Note that, by definition, active sessions are not included in this metric.</p>
</li>
<li>
<p><code>quilkin_session_total</code> (Counter)</p>
<p>The total number of sessions that have been created.</p>
</li>
</ul>
<h2 id="filter-metrics"><a class="header" href="#filter-metrics">Filter Metrics</a></h2>
<p>Quilkin's filters use a set of generic metric keys, to make it easier to build visualisations that can account for
a dynamic set of filters that can be added, removed, or updated at runtime with different configurations. All of
these metrics share a common set of labels.</p>
<div class="table-wrapper"><table><thead><tr><th>Label</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>The ID of the filter that used the metric.</td></tr>
<tr><td><code>label</code></td><td>The name of the metric being measured.</td></tr>
<tr><td><code>help</code></td><td>The description of the filter metric.</td></tr>
<tr><td><code>direction</code></td><td>The direction of packet flow (e.g. read/write).</td></tr>
</tbody></table>
</div>
<ul>
<li>
<p><code>quilkin_filter_int_counter{id, label, help, direction}</code>
Generic filter counter, see help label for more specific info.</p>
</li>
<li>
<p><code>quilkin_filter_histogram{id, label, help, direction, shared_metadata_1}</code>
generic filter histogram, see help label for more specific info.</p>
</li>
<li>
<p><code>quilkin_filter_read_duration_seconds{filter}</code></p>
<p>The duration it took for a <code>filter</code>'s <code>read</code> implementation to execute.</p>
<ul>
<li>The<code>filter</code> label is the name of the filter being executed.</li>
</ul>
</li>
<li>
<p><code>quilkin_filter_write_duration_seconds{filter}</code></p>
<p>The duration it took for a <code>filter</code>'s <code>write</code> implementation to execute.</p>
<ul>
<li>The <code>filter</code> label is the name of the filter being executed.</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../services/proxy/qcmp.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../services/xds.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../services/proxy/qcmp.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../services/xds.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
